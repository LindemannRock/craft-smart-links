!function(){"use strict";const e=window.smartLinksTracking||{},n=e.debug||!1,t=n?console.log.bind(console,"[Smart Links]"):()=>{},a=n?console.warn.bind(console,"[Smart Links]"):()=>{},o=console.error.bind(console,"[Smart Links]");if(!e.smartLinkId||!e.trackingEndpoint||!e.csrfEndpoint)return void a("Tracking not configured");if(window._smartLinksTracked)return void t("Already tracked on this page load");window._smartLinksTracked=!0;const i=e.redirectUrl,r=e.smartLinkId,c=e.trackAnalytics,d=e.trackingEndpoint,s=e.csrfEndpoint,l=new URLSearchParams(window.location.search).get("src")||"direct";t("Starting tracking...",{smartLinkId:r,source:l,trackAnalytics:c}),fetch(s,{credentials:"same-origin",cache:"no-store"}).then(e=>(t("CSRF response received"),e.json())).then(e=>{t("CSRF data:",e);const n=e.isMobile||"qr"===l;if(c&&n){t("Sending tracking beacon...");const n=new FormData;if(n.append("smartLinkId",r),n.append("platform","redirect"),n.append("url",i),n.append("source",l),n.append("CRAFT_CSRF_TOKEN",e.csrfToken),navigator.sendBeacon){const e=navigator.sendBeacon(d,n);t("Beacon sent:",e)}else t("Using fetch fallback"),fetch(d,{method:"POST",body:n,keepalive:!0}).then(()=>t("Fetch tracking sent")).catch(e=>o("Tracking failed:",e))}else t("Not tracking page load (desktop without QR parameter)");e.isMobile&&i?(t("Mobile detected, redirecting to:",i),window.location.replace(i)):t("Desktop device, showing page")}).catch(e=>{o("Error during tracking:",e),a("Device detection failed, page will load normally:",e)}),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".smartlink-btn, .trackable-link").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();const n=this.getAttribute("href"),t=this.textContent.trim(),a=this.getAttribute("data-platform")||t.toLowerCase().replace(/\s+/g,"-");fetch(s,{credentials:"same-origin",cache:"no-store"}).then(e=>e.json()).then(e=>{const t=new FormData;t.append("smartLinkId",r),t.append("platform",a),t.append("url",n),t.append("source","landing"),t.append("CRAFT_CSRF_TOKEN",e.csrfToken),fetch(d,{method:"POST",body:t}).then(()=>{window.location.href=n}).catch(()=>{window.location.href=n})}).catch(()=>{window.location.href=n})})})})}();