{#
  IP Hash Salt Error Component

  Displays error banner when IP hash salt is missing and analytics is enabled.
  Include this at the top of settings pages.
#}

{% set plugin = craft.app.plugins.getPlugin('smart-links') %}
{% set actualSalt = plugin.settings.ipHashSalt ?? null %}
{% set saltIsMissing = not actualSalt or actualSalt == '$SMART_LINKS_IP_SALT' %}

{% if plugin.settings.enableAnalytics and saltIsMissing %}
    <div class="error-summary" tabindex="-1" style="margin-bottom: 24px;">
        <div>
            <span class="notification-icon" data-icon="alert" aria-label="error" role="img"></span>
            <h2>Configuration Required</h2>
        </div>
        <ul class="errors">
            <li>
                <strong>IP hash salt is missing.</strong> Analytics tracking requires a secure salt for privacy protection.
                <br><br>
                <strong>Run one of these commands in your terminal:</strong>
                <br><br>

                <div>
                    <div style="margin-bottom: 12px;">
                        <strong style="font-size: 13px; color: #596673; display: block; margin-bottom: 4px;">Standard:</strong>
                        <div style="position: relative; display: flex; align-items: center; gap: 8px;">
                            <code id="salt-cmd-normal" style="background: #f9fafb; padding: 10px 12px; border-radius: 4px; flex: 1; border: 1px solid #e5e7eb; font-size: 13px; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;">php craft smart-links/security/generate-salt</code>
                            <button type="button" onclick="copyToClipboard('salt-cmd-normal', this)" style="background: #0d78f2; color: white; border: none; padding: 10px 16px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600; white-space: nowrap;">COPY</button>
                        </div>
                    </div>

                    <div>
                        <strong style="font-size: 13px; color: #596673; display: block; margin-bottom: 4px;">DDEV:</strong>
                        <div style="position: relative; display: flex; align-items: center; gap: 8px;">
                            <code id="salt-cmd-ddev" style="background: #f9fafb; padding: 10px 12px; border-radius: 4px; flex: 1; border: 1px solid #e5e7eb; font-size: 13px; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;">ddev craft smart-links/security/generate-salt</code>
                            <button type="button" onclick="copyToClipboard('salt-cmd-ddev', this)" style="background: #0d78f2; color: white; border: none; padding: 10px 16px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: 600; white-space: nowrap;">COPY</button>
                        </div>
                    </div>
                </div>

                <br>
                This will automatically add <code>SMART_LINKS_IP_SALT</code> to your <code>.env</code> file.
                <br>
                <strong style="color: #d97706;">⚠️ Important:</strong> Copy the same salt to staging and production environments.

                <script>
                function copyToClipboard(elementId, button) {
                    const element = document.getElementById(elementId);
                    const text = element.textContent;

                    navigator.clipboard.writeText(text).then(function() {
                        const originalText = button.textContent;
                        button.textContent = 'COPIED!';
                        button.style.background = '#10b981';

                        setTimeout(function() {
                            button.textContent = originalText;
                            button.style.background = '#0d78f2';
                        }, 2000);
                    }).catch(function(err) {
                        console.error('Failed to copy:', err);
                        alert('Failed to copy to clipboard');
                    });
                }
                </script>
            </li>
        </ul>
    </div>
{% endif %}
