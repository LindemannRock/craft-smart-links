{% extends "_layouts/elementindex" %}
{% set plugin = craft.app.plugins.getPlugin('smart-links') %}
{% set title = plugin.settings.pluginName|t('smart-links') %}
{% set elementType = 'lindemannrock\\smartlinks\\elements\\SmartLink' %}
{% set selectedSubnavItem = 'links' %}
{% set showSiteMenu = false %}

{# Site switcher (first item) #}
{% set crumbs = [] %}
{% if craft.app.getIsMultiSite() %}
    {% set currentSite = craft.app.sites.getCurrentSite() %}

    {# Get site menu items - only enabled sites #}
    {% set siteMenuItems = [] %}
    {% for site in plugin.getEnabledSites() %}
        {% set siteMenuItems = siteMenuItems|merge([{
            label: site.name,
            url: url('smart-links', {site: site.handle}),
            selected: site.id == currentSite.id
        }]) %}
    {% endfor %}

    {% set crumbs = [{
        id: 'site-crumb',
        icon: 'world',
        label: currentSite.name|t('site'),
        menu: {
            items: siteMenuItems,
            label: 'Select site'|t('app')
        }
    }] %}
{% endif %}

{% set crumbs = crumbs|merge([
    { label: plugin.settings.pluginName|t('smart-links'), url: url('smart-links') }
]) %}

{% block actionButton %}
    {% if currentUser.can('smartLinks:createLinks') %}
        <div class="btngroup">
            <a href="{{ url('smart-links/new') }}" class="btn submit add icon">{{ 'New smart link'|t('smart-links') }}</a>
        </div>
    {% endif %}
{% endblock %}