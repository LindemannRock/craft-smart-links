{% extends "_layouts/elementindex" %}
{% set plugin = craft.app.plugins.getPlugin('smart-links') %}
{% set title = plugin.settings.pluginName|t('smart-links') %}
{% set elementType = 'lindemannrock\\smartlinks\\elements\\SmartLink' %}
{% set selectedSubnavItem = 'links' %}
{% set showSiteMenu = false %}

{# Site switcher (first item) #}
{% set crumbs = [] %}
{% if craft.app.getIsMultiSite() %}
    {% set currentSite = craft.app.sites.getCurrentSite() %}
    {# Check for site parameter in URL to properly highlight selected site #}
    {% set siteParam = craft.app.request.getParam('site') %}
    {% set selectedSiteHandle = siteParam ?: currentSite.handle %}

    {# Get the actual selected site object for the label #}
    {% set selectedSite = siteParam ? craft.app.sites.getSiteByHandle(siteParam) : currentSite %}

    {# Get site menu items - only enabled sites #}
    {% set siteMenuItems = [] %}
    {% for site in plugin.getEnabledSites() %}
        {% set siteMenuItems = siteMenuItems|merge([{
            label: site.name,
            url: url('smart-links', {site: site.handle}),
            selected: site.handle == selectedSiteHandle
        }]) %}
    {% endfor %}

    {% set crumbs = [{
        id: 'site-crumb',
        icon: 'world',
        label: selectedSite.name|t('site'),
        menu: {
            items: siteMenuItems,
            label: 'Select site'|t('app')
        }
    }] %}
{% endif %}

{% set crumbs = crumbs|merge([
    { label: plugin.settings.pluginName|t('smart-links'), url: url('smart-links') }
]) %}

{% block actionButton %}
    {% if currentUser.can('smartLinks:createLinks') %}
        {% set singularName = plugin.settings.pluginName matches '/s$/' ? plugin.settings.pluginName|slice(0, -1) : plugin.settings.pluginName %}
        <div class="btngroup">
            <a href="{{ url('smart-links/new') }}" class="btn submit add icon">{{ 'New {name}'|t('smart-links', {name: singularName|lower}) }}</a>
        </div>
    {% endif %}
{% endblock %}