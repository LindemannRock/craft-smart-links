{% import "_includes/forms" as forms %}

{% set currentSite = craft.app.sites.getSiteById(smartLink.siteId ?? craft.app.sites.currentSite.id) %}
{% set locale = craft.app.i18n.getLocaleById(currentSite.language) %}
{% set textDir = locale.getOrientation() %}
{% set disabled = smartLink.getIsRevision() %}


{{ forms.textField({
    label: "Title"|t('smart-links'),
    instructions: "The title of this smart link"|t('smart-links'),
    id: 'title',
    name: 'title',
    value: smartLink.title ?? '',
    required: true,
    errors: smartLink.getErrors('title'),
    autofocus: true,
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    inputAttributes: {
        dir: textDir
    },
    disabled: disabled
}) }}

{{ forms.textareaField({
    label: "Description"|t('smart-links'),
    instructions: "A brief description of this smart link"|t('smart-links'),
    id: 'description',
    name: 'description',
    value: smartLink.description ?? '',
    rows: 3,
    errors: smartLink.getErrors('description'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    inputAttributes: {
        dir: textDir
    },
    disabled: disabled
}) }}

{# Smart Link Image field #}
{% set imageSources = craft.smartLinks.settings.imageVolumeUid ? ['volume:' ~ craft.smartLinks.settings.imageVolumeUid] : '*' %}
{% set selectedImage = smartLink.imageId ? craft.assets.id(smartLink.imageId).one() : null %}

{{ forms.elementSelectField({
    label: "Image"|t('smart-links'),
    instructions: "Select an image for this smart link"|t('smart-links'),
    id: 'imageId',
    name: 'imageId',
    elementType: 'craft\\elements\\Asset',
    sources: imageSources,
    criteria: {
        kind: ['image']
    },
    limit: 1,
    elements: selectedImage ? [selectedImage] : [],
    errors: smartLink.getErrors('imageId'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    disabled: disabled
}) }}

{{ forms.selectField({
    label: "Image Size"|t('smart-links'),
    instructions: "Select the size for the smart link image"|t('smart-links'),
    id: 'imageSize',
    name: 'imageSize',
    value: smartLink.imageSize ?? 'xl',
    options: [
        { label: 'Extra Large', value: 'xl' },
        { label: 'Large', value: 'lg' },
        { label: 'Medium', value: 'md' },
        { label: 'Small', value: 'sm' }
    ],
    errors: smartLink.getErrors('imageSize'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    disabled: disabled
}) }}

<hr>

<h2>{{ "App Store URLs"|t('smart-links') }}</h2>

<div class="field">
    <div class="instructions">
        <p>{{ "Enter the store URLs for each platform. The system will automatically redirect users to the appropriate store based on their device."|t('smart-links') }}</p>
    </div>
</div>

{{ forms.textField({
    label: "iOS URL"|t('smart-links'),
    instructions: "App Store URL for iOS devices"|t('smart-links'),
    id: 'iosUrl',
    name: 'iosUrl',
    value: smartLink.iosUrl ?? '',
    type: 'url',
    placeholder: 'https://apps.apple.com/app/id...',
    errors: smartLink.getErrors('iosUrl'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    disabled: disabled
}) }}

{{ forms.textField({
    label: "Android URL"|t('smart-links'),
    instructions: "Google Play Store URL for Android devices"|t('smart-links'),
    id: 'androidUrl',
    name: 'androidUrl',
    value: smartLink.androidUrl ?? '',
    type: 'url',
    placeholder: 'https://play.google.com/store/apps/details?id=...',
    errors: smartLink.getErrors('androidUrl'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    disabled: disabled
}) }}

{{ forms.textField({
    label: "Huawei URL"|t('smart-links'),
    instructions: "AppGallery URL for Huawei devices"|t('smart-links'),
    id: 'huaweiUrl',
    name: 'huaweiUrl',
    value: smartLink.huaweiUrl ?? '',
    type: 'url',
    placeholder: 'https://appgallery.huawei.com/app/...',
    errors: smartLink.getErrors('huaweiUrl'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    disabled: disabled
}) }}

{{ forms.textField({
    label: "Amazon URL"|t('smart-links'),
    instructions: "Amazon Appstore URL"|t('smart-links'),
    id: 'amazonUrl',
    name: 'amazonUrl',
    value: smartLink.amazonUrl ?? '',
    type: 'url',
    placeholder: 'https://www.amazon.com/gp/product/...',
    errors: smartLink.getErrors('amazonUrl'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    disabled: disabled
}) }}

{{ forms.textField({
    label: "Windows URL"|t('smart-links'),
    instructions: "Microsoft Store URL for Windows devices"|t('smart-links'),
    id: 'windowsUrl',
    name: 'windowsUrl',
    value: smartLink.windowsUrl ?? '',
    type: 'url',
    placeholder: 'https://apps.microsoft.com/detail/...',
    errors: smartLink.getErrors('windowsUrl'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    disabled: disabled
}) }}

{{ forms.textField({
    label: "Mac URL"|t('smart-links'),
    instructions: "Mac App Store URL"|t('smart-links'),
    id: 'macUrl',
    name: 'macUrl',
    value: smartLink.macUrl ?? '',
    type: 'url',
    placeholder: 'https://apps.apple.com/app/id...',
    errors: smartLink.getErrors('macUrl'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    disabled: disabled
}) }}

<hr>

{{ forms.textField({
    label: "Fallback URL"|t('smart-links'),
    instructions: "The URL to redirect to when no platform-specific URL is available"|t('smart-links'),
    id: 'fallbackUrl',
    name: 'fallbackUrl',
    value: smartLink.fallbackUrl ?? '',
    type: 'url',
    placeholder: 'https://example.com',
    required: true,
    errors: smartLink.getErrors('fallbackUrl'),
    translatable: craft.app.sites.getTotalEditableSites() > 1,
    disabled: disabled
}) }}

<hr>

<h2>{{ "Display Settings"|t('smart-links') }}</h2>

{{ forms.lightswitchField({
    label: "Hide Title on Landing Pages"|t('smart-links'),
    instructions: "Hide the smart link title on both redirect and QR code landing pages"|t('smart-links'),
    id: 'hideTitle',
    name: 'hideTitle',
    on: smartLink.hideTitle ?? false,
    disabled: disabled
}) }}

<hr>

<h2>{{ "Advanced Settings"|t('smart-links') }}</h2>

{{ forms.lightswitchField({
    label: "Language Detection"|t('smart-links'),
    instructions: "Enable automatic language detection to redirect users based on their browser or location"|t('smart-links'),
    id: 'languageDetection',
    name: 'languageDetection',
    on: smartLink.languageDetection ?? false,
    disabled: disabled
}) }}

{{ forms.textField({
    label: "Icon"|t('smart-links'),
    instructions: "Icon identifier or URL for this smart link"|t('smart-links'),
    id: 'icon',
    name: 'icon',
    value: smartLink.icon ?? '',
    errors: smartLink.getErrors('icon'),
    inputAttributes: {
        dir: textDir
    },
    disabled: disabled
}) }}